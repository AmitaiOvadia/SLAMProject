#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\begin_preamble
% Necessary Commands:
\usepackage{autobreak}
\usepackage{relsize}
% Set vertical space before and after dislpay equations to be longer for better redability:
\AtBeginDocument{\setlength\abovedisplayskip{12pt}}
\AtBeginDocument{\setlength\belowdisplayskip{12pt}}
\AtBeginDocument{\setlength\belowdisplayshortskip{12pt}}
\AtBeginDocument{\setlength\belowdisplayshortskip{12pt}}

% Set space between words to be wider:
\spaceskip=1.3\fontdimen2\font plus 1\fontdimen3\font minus 1.5\fontdimen4\font

% Convert the Lyx colors into more pleasent colors:
\usepackage{xcolor}
\definecolor{blue}{RGB}{12,97,197}
\definecolor{green}{RGB}{0,128,40}
\definecolor{red}{RGB}{235,16,16}
\definecolor{brown}{RGB}{154,58,0}
\definecolor{orange}{RGB}{231,135,26}
\definecolor{purple}{RGB}{94,53,177}

% Convert the QED Symbol at the end of proofs to a solid black square (credit: Yakir Oz):
\usepackage{amssymb}
\renewcommand{\qedsymbol}{$\blacksquare$}

% Make the layout more similar to Hebrew Article, which I am more used to:
\renewcommand*{\@seccntformat}[1]{\hspace{0.5cm}\csname the#1\endcsname\hspace{0.5cm}} 
\usepackage{titlesec}
\titleformat{\section}{\fontsize{20}{20}\bfseries}{\thesection}{10pt}{}
\titleformat{\subsection}{\fontsize{15}{15}\bfseries}{\thesubsection}{10pt}{}
\titleformat{\subsubsection}{\bfseries}{\thesubsubsection}{10pt}{}

% Create disjoint union symbols:
\makeatletter
\def\moverlay{\mathpalette\mov@rlay}
\def\mov@rlay#1#2{\leavevmode\vtop{%
   \baselineskip\z@skip \lineskiplimit-\maxdimen
   \ialign{\hfil$\m@th#1##$\hfil\cr#2\crcr}}}
\newcommand{\charfusion}[3][\mathord]{
    #1{\ifx#1\mathop\vphantom{#2}\fi
        \mathpalette\mov@rlay{#2\cr#3}
      }
    \ifx#1\mathop\expandafter\displaylimits\fi}
\makeatother
\newcommand{\cupdot}{\charfusion[\mathbin]{\cup}{\cdot}}
\newcommand{\bigcupdot}{\charfusion[\mathop]{\bigcup}{\cdot}}

\newcommand{\kaliLargeLand}{\mathop{\mathlarger{\mathlarger{\mathlarger{\land}}}}}
\end_preamble
\use_default_options true
\begin_modules
theorems-ams
\end_modules
\maintain_unincluded_children false
\begin_local_layout
Style Section
	Font
	  Series     Medium
	  Shape      Smallcaps
	  Size       Larger
	  Series     Bold
	EndFont
	TocLevel 1
End


Style Section*
	Font
	  Series     Medium
	  Shape      Smallcaps
	  Size      Larger
	  Series     Bold
	EndFont
End


Style Solution

	LabelString           "פיתרון: "
End


Style Notation

	LabelString           "סימון  \thetheorem: "
End

Style Theorem

	LabelString           "משפט \thetheorem: "
End

Style Property

	LabelString           "תזכורת: "
End
\end_local_layout
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "David"
\font_sans "default" "David"
\font_typewriter "default" "David"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing onehalf
\use_hyperref true
\pdf_bookmarks true
\pdf_bookmarksnumbered false
\pdf_bookmarksopen false
\pdf_bookmarksopenlevel 1
\pdf_breaklinks false
\pdf_pdfborder false
\pdf_colorlinks false
\pdf_backref false
\pdf_pdfusetitle true
\papersize default
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 1cm
\topmargin 2cm
\rightmargin 1cm
\bottommargin 3cm
\headheight 0cm
\headsep 0cm
\footskip 2cm
\secnumdepth -2
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation 0bp
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard
\begin_inset Box Doublebox
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
\begin_inset CommandInset include
LatexCommand include
filename "../../../../../AppData/Roaming/LyX2.3/bind"

\end_inset


\end_layout

\begin_layout Plain Layout
\align center

\size giant
Vision Aided Navigation 2024 - Exercise 7
\end_layout

\begin_layout Plain Layout
\align center

\size larger
Amitai ovadia - 312244254
\end_layout

\begin_layout Plain Layout
\align center
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
today
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset space \space{}
\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset space \space{}
\end_inset


\end_layout

\begin_layout Standard
Amitai Ovadia 312244254
\end_layout

\begin_layout Standard
https://github.com/AmitaiOvadia/SLAMProject/blob/main/VAN_ex/code/ex7/Ex7.py
\end_layout

\begin_layout Standard
And 
\end_layout

\begin_layout Standard
https://github.com/AmitaiOvadia/SLAMProject/blob/main/VAN_ex/code/utils/BundleAdj
usment.py
\end_layout

\begin_layout Standard
https://github.com/AmitaiOvadia/SLAMProject/blob/main/VAN_ex/code/utils/PoseGraph.
py
\end_layout

\begin_layout Section
Question 7.1 Detect Loop Closure Candidates
\end_layout

\begin_layout Standard
For each frame iterate over all the previous frames.
\end_layout

\begin_layout Standard
find the shortest path from 
\begin_inset Formula $c_{n}$
\end_inset

 to 
\begin_inset Formula $c_{i}$
\end_inset

 and sum the covariances along the path to get an estimate of the relative
 covariance 
\begin_inset Formula $\varSigma_{n|i}$
\end_inset

.
\end_layout

\begin_layout Itemize
What are reasonable choices for edge weights? i.e.
 in what way is the chosen path the shortest?
\end_layout

\begin_deeper
\begin_layout Standard
Each edge represented the uncertanty from trasnlating from one pose to the
 next, so I needed someway to
\end_layout

\begin_layout Standard
take this uncertainty (a matrix of size 6 by 6) and reduce it to a single
 number.
 
\end_layout

\begin_layout Standard
So I took the square root determinant of this motion covariance,
\end_layout

\begin_layout Standard
beacuse it represented a measure proprtional to the 'volume' of this covariance
 
\end_layout

\begin_layout Standard
(the volume of the elipsoid represented by the covariance at mahalanobis
 distance of 1).
\end_layout

\begin_layout Standard
The path is shortest in the sense that the accumulated uncertanty, or the
 approximation of it along this path, is the smallest.
 
\end_layout

\end_deeper
\begin_layout Itemize
How did you implement the shortest path algorithm?
\end_layout

\begin_deeper
\begin_layout Standard
I used the networkx python library, each edge 
\begin_inset Formula $\left[v_{1},v_{2}\right]$
\end_inset

 got an attribute 'weight' that represented this motion's covariance's 
\end_layout

\begin_layout Standard
'volume' from 
\begin_inset Formula $v_{1}$
\end_inset

 to 
\begin_inset Formula $v_{2}$
\end_inset

.
 
\end_layout

\begin_layout Standard
The fucntion signiture was:
\end_layout

\begin_layout Standard
nx.shortest_path(self.loop_closure_graph, 
\begin_inset Formula $source=v_{1}$
\end_inset

, 
\begin_inset Formula $target=v_{2}$
\end_inset

, 
\begin_inset Formula $weight='weight'$
\end_inset

).
\end_layout

\begin_layout Standard
I think the default method they use is dijkstra.
\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Section
Question 7.2 Detect Loop Closure Candidates
\end_layout

\begin_layout Itemize
What was your chosen threshold? 
\end_layout

\begin_deeper
\begin_layout Standard
For selecting the loop closure candidates I used mahalanobis distance of
 750.
\end_layout

\begin_layout Standard
And the cancidate accepted to the loop closure club if it passed the 50
 inliers threshold after the ransac and pnp.
 
\end_layout

\end_deeper
\begin_layout Section
Question 7.3 Relative Pose Estimation
\end_layout

\begin_layout Standard
For every loop closure frames pair candidate I perform a small Bundle optimizati
on to extract 
\end_layout

\begin_layout Standard
the relative pose of the two frames as well as its covariance.
\end_layout

\begin_layout Itemize
What is a reasonable initial solution for the Bundle? 
\end_layout

\begin_deeper
\begin_layout Standard
The initial solution is the relative 
\begin_inset Formula $\left[R|t\right]$
\end_inset

 between the 2 frames obtained from the 
\begin_inset Formula $pnp$
\end_inset

 algorithem and the RANSAC.
\end_layout

\end_deeper
\begin_layout Itemize
How did you extract the appropriate covariance? 
\end_layout

\begin_deeper
\begin_layout Standard
I got the marginal covariance of the 2 cameras after optimizing the bundel.
 
\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Section
Question 7.5
\end_layout

\begin_layout Itemize
How many successful loop closures were detected? 
\end_layout

\begin_deeper
\begin_layout Standard
the total number of loop closure detected was: 50 across 32 loop closure
 frames (frames from which at least one loop closure was detected) 
\end_layout

\begin_layout Standard
For example frame 3320 was paired with frames 315, 2366, 308, 30, 2373.
\end_layout

\end_deeper
\begin_layout Itemize
Plot the match results of a single successful consensus match of your choice.
 (For the left images, inliers and outliers in different color):
\end_layout

\begin_deeper
\begin_layout Standard
A match between frame 3217 and 2271:
\end_layout

\begin_layout Standard
Inliers in cyan and outliers in orange.
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename pasted1.png
	scale 75

\end_inset


\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Itemize
Choose 4 versions of the pose graph along the process and plot them (including
 location covariance).
 
\end_layout

\begin_deeper
\begin_layout Standard
Explain at what points you chose to plot the graph.
\end_layout

\begin_layout Standard
Before optimization:
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename pasted2.png
	scale 50

\end_inset


\end_layout

\begin_layout Standard
After the first loop closure (you can see that the trajectory is more straight,
 but the covariances don't seem to change)
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename pasted3.png
	scale 50

\end_inset


\end_layout

\begin_layout Standard
After half of the loop closures:
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename pasted4.png
	scale 50

\end_inset


\end_layout

\begin_layout Standard
After optimization ended
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename pasted5.png
	scale 50

\end_inset


\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Itemize
Plot the pose graph locations along with the ground truth both with and
 without loop closures.
\end_layout

\begin_deeper
\begin_layout Standard
Before optimization:
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename pasted6.png
	scale 65

\end_inset


\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Itemize
After the first loop closure:
\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset Graphics
	filename pasted7.png
	scale 65

\end_inset


\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Itemize
After the second loop closure area:
\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset Graphics
	filename pasted8.png
	scale 65

\end_inset


\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Itemize
After the end of the loop closure optimization:
\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset Graphics
	filename pasted9.png
	scale 65

\end_inset


\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Itemize
Plot a graph of the absolute location error for the whole pose graph both
 with and without loop closures:
\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset Graphics
	filename pasted10.png
	scale 65

\end_inset


\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Itemize
Plot a graph of the location uncertainty size for the whole pose graph both
 with and without loop closures.
 
\end_layout

\begin_deeper
\begin_layout Standard
(What measure of uncertainty size did you choose?)
\end_layout

\begin_layout Standard
The measure of uncertanty that I chose was as follows: 
\end_layout

\begin_layout Standard
I took 
\begin_inset Formula $\varSigma_{k|0}$
\end_inset

 the marginal covariance between the key-frame 
\begin_inset Formula $k$
\end_inset

 and the starting frame 
\begin_inset Formula $0.$
\end_inset


\end_layout

\begin_layout Standard
I took the bottom right 
\begin_inset Formula $3\times3$
\end_inset

matrix 
\begin_inset Formula $\varSigma_{k|0}\left[3:,3:\right]$
\end_inset

 which corresponds to the location covariance
\end_layout

\begin_layout Standard
And I computed the square root of the determinant of it, which is proportional
 to the 
\end_layout

\begin_layout Standard
'volume' of the elipse that corresponds to this covariance.
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename pasted11.png
	scale 60

\end_inset


\end_layout

\begin_layout Standard
It's clear that the uncertainty is reduced in the areas where there are
 loop closures, and it is much better than the initial uncertainty.
\end_layout

\end_deeper
\end_body
\end_document
